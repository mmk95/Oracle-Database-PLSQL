-- Táblák eldobása
--DROP TABLE PN_REKLAM_SOR;
--DROP TABLE PN_REKLAM;
--DROP TABLE B_SZAMLA_SOR;
--DROP TABLE B_SZAMLA;
--DROP TABLE B_SZALLITOK_SOR;
--DROP TABLE B_SZALLITOK;
-- Táblák létrehozása
CREATE TABLE PN_REKLAM (
    PN_REKLAM_ID INTEGER PRIMARY KEY NOT NULL,
    B_BIZ_ID INTEGER
);
CREATE TABLE PN_REKLAM_SOR (
    PN_REKLAM_SOR_ID INTEGER PRIMARY KEY NOT NULL,
    PN_REKLAM_ID INTEGER,
    B_BIZ_SOR_ID INTEGER,
    B_BIZ_TIP_ID CHAR(1) CHECK (B_BIZ_TIP_ID IN ('1', '2')),
    SZOVEG VARCHAR2(2000),
    ROGZITES DATE,
    FOREIGN KEY (PN_REKLAM_ID) REFERENCES PN_REKLAM(PN_REKLAM_ID)
);
CREATE TABLE B_SZAMLA (
    B_SZAMLA_ID INTEGER PRIMARY KEY NOT NULL,
    SZAMLASZAM VARCHAR2(15),
    PN_TORZS_ID NUMBER(9),
    CEGNEV VARCHAR2(100)
);
CREATE TABLE B_SZAMLA_SOR (
    B_SZAMLA_SOR_ID INTEGER PRIMARY KEY NOT NULL,
    B_SZAMLA_ID INTEGER,
    CK_CIKK_ID INTEGER,
    CIKK_NEV VARCHAR2(200),
    FOREIGN KEY (B_SZAMLA_ID) REFERENCES B_SZAMLA(B_SZAMLA_ID)
);?
CREATE TABLE B_SZALLITOK (
    B_SZALLITOK_ID INTEGER PRIMARY KEY NOT NULL,
    BIZ_SZAM VARCHAR2(20),
    PN_TORZS_ID INTEGER,
    CEGNEV VARCHAR2(250)
);
CREATE TABLE B_SZALLITOK_SOR (
    B_SZALLITOK_SOR_ID INTEGER PRIMARY KEY NOT NULL,
    B_SZALLITOK_ID INTEGER,
    CK_CIKK_ID INTEGER,
    CIKK_NEV VARCHAR2(200),
    FOREIGN KEY (B_SZALLITOK_ID) REFERENCES B_SZALLITOK(B_SZALLITOK_ID)
);
-- Táblák feltöltése
INSERT INTO PN_REKLAM VALUES (54974, 8011550);
INSERT INTO PN_REKLAM VALUES (52920, 7776435);
INSERT INTO PN_REKLAM VALUES (48766, 946956);
INSERT INTO PN_REKLAM VALUES (47906, 931806);

INSERT INTO PN_REKLAM_SOR VALUES (42660, 54974, 52988030, '1', 'Reklamáció szövege', SYSDATE);
INSERT INTO PN_REKLAM_SOR VALUES (42659, 54974, 52988040, '1', 'Reklamáció szövege', SYSDATE);
INSERT INTO PN_REKLAM_SOR VALUES (42658, 54974, 52988035, '1', 'Reklamáció szövege', SYSDATE);
INSERT INTO PN_REKLAM_SOR VALUES (41008, 52920, NULL, '1', 'Reklamáció szövege', SYSDATE);
INSERT INTO PN_REKLAM_SOR VALUES (37625, 48766, NULL, '2', 'Reklamáció szövege', SYSDATE);
INSERT INTO PN_REKLAM_SOR VALUES (36960, 47906, 4981216, '2', 'Reklamáció szövege', SYSDATE);
INSERT INTO PN_REKLAM_SOR VALUES (36959, 47906, 4981206, '2', 'Reklamáció szövege', SYSDATE);

INSERT INTO B_SZAMLA VALUES (8011550, 'KHG22-027429', 121902, 'Partner 121902 Kft.');
INSERT INTO B_SZAMLA VALUES (7776435, 'UHG22-04260', 143472, 'Partner 143472 Kft.');
INSERT INTO B_SZAMLA VALUES (946956, 'sz.szam1', 30059, 'Partner 30059 Kft.');
INSERT INTO B_SZAMLA VALUES (931806, 'sz.szam2', 15928, 'Partner 15928 Kft.');

INSERT INTO B_SZAMLA_SOR VALUES (42660, 8011550, 101352, 'Tigrisrák');
INSERT INTO B_SZAMLA_SOR VALUES (42659, 8011550, 197505, 'Marha');
INSERT INTO B_SZAMLA_SOR VALUES (42658, 8011550, 103354, 'Csirkecomb');
INSERT INTO B_SZAMLA_SOR VALUES (41008, 7776435, NULL, NULL);
INSERT INTO B_SZAMLA_SOR VALUES (37625, 946956,NULL , NULL);
INSERT INTO B_SZAMLA_SOR VALUES (36960, 931806, 198729, 'Paszternák');
INSERT INTO B_SZAMLA_SOR VALUES (36959, 931806, 199861, 'Articsóka');

INSERT INTO B_SZALLITOK VALUES (8011550, 'sz.szam1', 121902, 'Partner 121902 Kft.');
INSERT INTO B_SZALLITOK VALUES (7776435, 'sz.szam2', 143472, 'Partner 143472 Kft.');
INSERT INTO B_SZALLITOK VALUES (946956, 'SHG21-02609', 30059, 'Partner 30059 Kft.');
INSERT INTO B_SZALLITOK VALUES (931806, 'SHG21-02360', 15928, 'Partner 15928 Kft.');

INSERT INTO B_SZALLITOK_SOR VALUES (42660, 8011550, 101352, 'Tigrisrák');
INSERT INTO B_SZALLITOK_SOR VALUES (42659, 8011550, 197505, 'Marha');
INSERT INTO B_SZALLITOK_SOR VALUES (42658, 8011550, 103354, 'Csirkecomb');
INSERT INTO B_SZALLITOK_SOR VALUES (41008, 7776435, NULL, NULL);
INSERT INTO B_SZALLITOK_SOR VALUES (37625, 946956, NULL, NULL);
INSERT INTO B_SZALLITOK_SOR VALUES (36960, 931806, 198729, 'Paszternák');
INSERT INTO B_SZALLITOK_SOR VALUES (36959, 931806, 199861, 'Articsóka');
-- Lekérdezés
UPDATE (
    SELECT b_szamla_sor.cikk_nev
    FROM b_szamla_sor
    INNER JOIN pn_reklam_sor ON b_szamla_sor.b_szamla_sor_id = pn_reklam_sor.pn_reklam_sor_id
    WHERE pn_reklam_sor.b_biz_sor_id IS NULL
) SET cikk_nev = 'Tételfüggetlen reklamáció';               
SELECT
    pn_reklam.pn_reklam_id,
    pn_reklam.b_biz_id, 
    pn_reklam_sor.b_biz_tip_id,
    CASE 
        WHEN pn_reklam_sor.b_biz_tip_id = 1 THEN 'Számla'
        WHEN pn_reklam_sor.b_biz_tip_id = 2 THEN 'Szállítólevél'
    END AS BIZ_TIP_NEV,
    CASE 
        WHEN pn_reklam_sor.b_biz_tip_id = 1 THEN b_szamla.szamlaszam
        WHEN pn_reklam_sor.b_biz_tip_id = 2 THEN b_szallitok.biz_szam
    END AS BIZ_SZAM,
    b_szallitok.pn_torzs_id, 
    pn_reklam_sor.pn_reklam_sor_id,
    pn_reklam_sor.b_biz_sor_id, 
    b_szamla_sor.ck_cikk_id, 
    b_szamla_sor.cikk_nev, 
    pn_reklam_sor.szoveg, 
    pn_reklam_sor.rogzites
FROM 
    pn_reklam
    INNER JOIN pn_reklam_sor ON pn_reklam.pn_reklam_id = pn_reklam_sor.pn_reklam_id
    INNER JOIN b_szamla ON pn_reklam.b_biz_id = b_szamla.b_szamla_id
    INNER JOIN b_szallitok ON pn_reklam.b_biz_id = b_szallitok.b_szallitok_id
    INNER JOIN b_szamla_sor ON pn_reklam_sor.pn_reklam_sor_id = b_szamla_sor.b_szamla_sor_id 

 

